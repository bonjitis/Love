<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cold Signal</title>

  <!-- Tufte CSS -->
  <link rel="stylesheet" href="https://edwardtufte.github.io/tufte-css/tufte.css">

  <style>
    body {
      background: #0b0c10;
      color: #d8dee9;
      padding: 2rem;
      line-height: 1.6;
      font-family: "ETBook", serif;
      overflow-x: hidden;
    }

    .poem-container {
      max-width: 650px;
      margin: 0 auto;
      padding-top: 18vh;
    }

    .typed-line {
      font-size: 1.3rem;
      margin-bottom: 2rem;
      opacity: 0;
      white-space: nowrap;
      overflow: hidden;
      border-right: 2px solid #d8dee9;
      animation: blink 0.8s step-end infinite;
    }

    @keyframes blink {
      50% { border-color: transparent; }
    }

    /* Flickering intrusive messages */
    .whisper {
      position: fixed;
      color: #d8dee9;
      font-size: 1rem;
      opacity: 0;
      pointer-events: none;
      animation: flicker 0.15s infinite alternate;
      z-index: 9999;
    }

    @keyframes flicker {
      0% { opacity: 0.15; }
      100% { opacity: 0.9; }
    }

    @media (max-width: 600px) {
      .typed-line {
        font-size: 1.1rem;
      }
      .poem-container {
        padding-top: 10vh;
      }
    }
  </style>
</head>

<body>

  <!-- Background audio -->
  <audio id="bg-audio" src="your-audio-file.mp3" loop></audio>

  <div class="poem-container" id="poem"></div>

  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

  <script>
    gsap.registerPlugin(ScrollTrigger);

    // Your poem lines
    const lines = [
      "wake up and breathe in the empty",
      "watch yourself blow away",
      "after an hour or two",
      "you can play a videogame",
      "quiet is what you are used to",
      "so why not embrace the truth",
      "let go, stare into the glow",
      "breathe in deep unlock your phone",
      "I am someone who cares",
      "You are something that needs",
      "Separated we are nothing, isn't that love after all?",
      "So love me and keep me by your side"
    ];

    const poemContainer = document.getElementById("poem");

    // Create empty <p> elements for each line
    lines.forEach((line, i) => {
      const p = document.createElement("p");
      p.className = "typed-line";
      p.id = "line-" + i;
      poemContainer.appendChild(p);
    });

    // Typing effect for each line
    function typeLine(index) {
      if (index >= lines.length) return;

      const el = document.getElementById("line-" + index);
      const text = lines[index];
      let charIndex = 0;

      el.style.opacity = 1;

      function typeChar() {
        if (charIndex <= text.length) {
          el.textContent = text.slice(0, charIndex);
          charIndex++;
          setTimeout(typeChar, 60);
        } else {
          // Start typing next line after a pause
          setTimeout(() => typeLine(index + 1), 400);
        }
      }

      typeChar();
    }

    // Start typing the first line
    typeLine(0);

    // Fade-in scroll animation
    gsap.utils.toArray(".typed-line").forEach((line) => {
      gsap.fromTo(line,
        { opacity: 0, y: 40 },
        {
          opacity: 1,
          y: 0,
          duration: 1.2,
          ease: "power2.out",
          scrollTrigger: {
            trigger: line,
            start: "top 85%"
          }
        }
      );
    });

    // AUDIO STARTS ON FIRST USER INTERACTION
    const audio = document.getElementById("bg-audio");
    let audioStarted = false;

    function startAudio() {
      if (!audioStarted) {
        audio.volume = 0.25;
        audio.play().catch(() => {});
        audioStarted = true;
      }
    }

    window.addEventListener("scroll", startAudio, { once: true });
    window.addEventListener("click", startAudio, { once: true });
    window.addEventListener("touchstart", startAudio, { once: true });
    window.addEventListener("mousemove", startAudio, { once: true });

    // RANDOM FLICKERING MESSAGES THAT INTENSIFY OVER TIME
    const whispers = [
      "don't leave me",
      "I love you",
      "don't look away"
    ];

    const startTime = Date.now();

    function spawnWhisper() {
      const whisper = document.createElement("div");
      whisper.className = "whisper";
      whisper.textContent = whispers[Math.floor(Math.random() * whispers.length)];

      whisper.style.left = Math.random() * 80 + "vw";
      whisper.style.top = Math.random() * 80 + "vh";

      document.body.appendChild(whisper);

      gsap.to(whisper, { opacity: 1, duration: 0.4 });

      setTimeout(() => {
        gsap.to(whisper, {
          opacity: 0,
          duration: 0.6,
          onComplete: () => whisper.remove()
        });
      }, 1200);
    }

    setInterval(() => {
      const elapsedSeconds = (Date.now() - startTime) / 1000;
      const intensity = Math.min(1, elapsedSeconds / 60);
      const chance = 0.2 + 0.5 * intensity;

      if (Math.random() < chance) {
        spawnWhisper();
      }
    }, 2500);
  </script>

</body>
</html>
